# `react-component-search`

A powerful and flexible search solution for React and Next.js projects. This package provides hooks and utilities to dynamically search through JSX components, including searching for text content in your components and generating a searchable index. The package includes server-side and client-side hooks for easy integration.

## Features

- Search through JSX components and HTML content in a React/Next.js project.
- Generates search indexes and component maps dynamically.
- Provides a flexible API for client-side searching with hooks.
- Includes dynamic imports for components, making them lazy-loadable.
- Easy integration with Next.js API routes and client-side search UI.

## Installation

You can install the package via npm:

```bash
npm install react-component-search
```

Or with yarn:

```bash
yarn add react-component-search
```

## Usage

### 1. Indexing Components

The package provides a method to generate a search index of your components and their content. You can call `buildIndexes` to automatically generate both `search-index.json` and a dynamic `componentMap.ts` file.

```typescript
import { buildIndexes } from 'react-component-search';

buildIndexes();  // Generates search index and component map
```

This will create two files in the `src/data` folder:
- `search-index.json`: A searchable index of your components.
- `componentMap.ts`: A dynamic map for lazy-loading components.

### 2. Using the Search Hook

You can use the `useSearch` hook to integrate search functionality in your React components. This hook works by fetching the search index from the server and filtering the results based on the user's query.

```typescript
import { useSearch } from 'react-component-search';

const SearchComponent = () => {
  const { query, setQuery, results, loading, handleSearchSubmit } = useSearch(
    (query, results) => {
      console.log('Search complete:', query, results);
    }
  );

  return (
    <form onSubmit={handleSearchSubmit}>
      <input
        type="text"
        value={query}
        onChange={(e) => setQuery(e.target.value)}
        placeholder="Search components..."
      />
      {loading ? <p>Loading...</p> : <ul>{results.map((res) => <li key={res.path}>{res.content}</li>)}</ul>}
    </form>
  );
};
```

### 3. Client-Side Dynamic Imports

For optimized performance, components can be lazily loaded using dynamic imports. The `useSearchDynamicImport` hook is used to dynamically import a component based on the search result.

```typescript
import { useSearchDynamicImport } from 'react-component-search';
import { componentMap } from '@/data/componentMap';

const SearchResultComponent = ({ path }) => {
  const Component = useSearchDynamicImport(path, componentMap);

  if (!Component) return <p>Loading component...</p>;

  return <Component />;
};
```

### 4. API Route for Server-Side Search

You can use the API to perform searches on the server side by querying the `search-index.json` file.

```typescript
import { searchIndex } from 'react-component-search/api';

const results = searchIndex("your search term");
console.log(results);
```

## API Reference

### `buildIndexes()`

Generates the search index and component map.

- **Usage**: `buildIndexes()`

### `generateSearchIndex()`

Generates the search index by scanning components and extracting content.

- **Returns**: `SearchIndexEntry[]`
  - `path`: The file path of the component.
  - `content`: The matching content within the component.

### `generateComponentMap()`

Generates a dynamic map for lazy-loading components.

- **Parameters**: `entries` (Array of `SearchIndexEntry[]`).

### `useSearch`

Custom React hook that provides search functionality.

- **Parameters**:
  - `onSearchComplete`: Callback function for when search is completed.
  - `apiUrl`: The URL for the search API (default is `/api/search-index`).
  - `queryParams`: Additional query parameters for the search API (optional).

- **Returns**:
  - `query`: The current search query.
  - `setQuery`: Function to update the query.
  - `results`: The filtered search results.
  - `error`: Any errors that occurred while fetching the search index.
  - `loading`: Whether the search is currently loading.
  - `showResults`: Whether to show the search results.
  - `groupedResults`: The results grouped by file paths.
  - `handleSearchSubmit`: Form submission handler.
  - `handleInputChange`: Input change handler.

### `useSearchDynamicImport`

Custom hook for dynamically importing a component based on its path.

- **Parameters**:
  - `path`: The path of the component.
  - `componentMap`: The dynamic component map (generated by `generateComponentMap()`).

- **Returns**: A dynamically loaded React component.

## Example Project Structure

```
src/
  components/
    MyComponent.tsx
    AnotherComponent.tsx
  data/
    search-index.json
    componentMap.ts
  hooks/
    use-search.ts
    use-searchApi.ts
    use-searchContent.ts
    use-searchDynamicImport.ts
    use-searchResult.ts
  api.ts
  index.ts
```

## Contributing

We welcome contributions! If you have a feature request or find a bug, feel free to open an issue or submit a pull request.

## License

This package is licensed under the MIT License. See LICENSE for more details.
